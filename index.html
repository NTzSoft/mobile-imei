<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>สถานะเครื่องมือถือ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <header class="bg-blue-600 text-white p-4 shadow-md">
    <h1 class="text-xl font-semibold">แสดงสถานะเครื่องมือถือ</h1>
  </header>

  <main class="p-6">
    <div class="mb-6 flex gap-2">
      <button onclick="filterStatus('all')" class="bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded">ทั้งหมด</button>
      <button onclick="filterStatus('Active')" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Active</button>
      <button onclick="filterStatus('')" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">ยังไม่ Active</button>
    </div>

    <div id="data-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      <!-- กล่องมือถือจะถูกสร้างที่นี่ -->
    </div>
  </main>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSVlzVoxxhwFOFIfeQQEkPLbXHjdnyvuYTi6-UQJnldE9txyBc-EQbGKqwDP1j8-6zZoZC8r846lt1Q/pub?output=csv";

    let rawData = [];

    function csvToJson(csv) {
      const lines = csv.trim().split('\n');
      const headers = lines[0].split(',');

      return lines.slice(1).map(line => {
        const values = line.split(',');
        let obj = {};
        headers.forEach((h, i) => {
          obj[h.trim()] = values[i] ? values[i].trim() : '';
        });
        return obj;
      });
    }

    function loadData() {
      fetch(csvUrl)
        .then(response => response.text())
        .then(csvText => {
          rawData = csvToJson(csvText);
          renderBoxes(rawData);
        })
        .catch(err => {
          console.error('Error loading CSV:', err);
          alert('ไม่สามารถโหลดข้อมูลจาก Google Sheets ได้');
        });
    }

    function renderBoxes(data) {
      const container = document.getElementById('data-container');
      container.innerHTML = '';

      if (data.length === 0) {
        container.innerHTML = '<p class="text-center text-gray-500 col-span-full">ไม่มีข้อมูล</p>';
        return;
      }

      data.forEach(row => {
        const box = document.createElement('div');
        box.className = "bg-white rounded-lg shadow p-4 flex flex-col justify-between";

        // กำหนดสีสถานะ
        let statusColor = 'text-gray-500';
        if (row["สถานะ"] === 'Active') statusColor = 'text-green-600 font-semibold';
        else if (row["สถานะ"] === '') statusColor = 'text-red-600 font-semibold';

        box.innerHTML = `
          <div>
            <h2 class="text-lg font-bold mb-1">${row["รุ่น"] || '-'}</h2>
            <p class="text-sm mb-1"><span class="font-semibold">สี:</span> ${row["สี"] || '-'}</p>
            <p class="text-sm mb-1"><span class="font-semibold">ร้าน:</span> ${row["ร้าน"] || '-'}</p>
            <p class="text-sm mb-1"><span class="font-semibold">IMEI:</span> ${row["IMEI"] || '-'}</p>
          </div>
          <div class="mt-3">
            <p class="${statusColor}"><span class="font-semibold">สถานะ:</span> ${row["สถานะ"] || 'ยังไม่ Active'}</p>
            <p class="text-sm text-gray-400"><span class="font-semibold">หมายเหตุ:</span> ${row["หมายเหตุ"] || '-'}</p>
          </div>
        `;
        container.appendChild(box);
      });
    }

    function filterStatus(status) {
      if (status === 'all') {
        renderBoxes(rawData);
      } else {
        const filtered = rawData.filter(row => (row["สถานะ"] || '') === status);
        renderBoxes(filtered);
      }
    }

    loadData();
  </script>
</body>
</html>
